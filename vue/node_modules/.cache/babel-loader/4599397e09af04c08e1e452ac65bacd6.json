{"ast":null,"code":"import { inject, ref, h } from 'vue';\nimport { debounce } from 'lodash-unified';\nimport '../../../../utils/index.mjs';\nimport { getCell, getColumnByCell, createTablePopper } from '../util.mjs';\nimport { TABLE_INJECTION_KEY } from '../tokens.mjs';\nimport { hasClass, getStyle } from '../../../../utils/dom/style.mjs';\n\nfunction useEvents(props) {\n  const parent = inject(TABLE_INJECTION_KEY);\n  const tooltipContent = ref(\"\");\n  const tooltipTrigger = ref(h(\"div\"));\n\n  const handleEvent = (event, row, name) => {\n    var _a;\n\n    const table = parent;\n    const cell = getCell(event);\n    let column;\n    const namespace = (_a = table == null ? void 0 : table.vnode.el) == null ? void 0 : _a.dataset.prefix;\n\n    if (cell) {\n      column = getColumnByCell({\n        columns: props.store.states.columns.value\n      }, cell, namespace);\n\n      if (column) {\n        table == null ? void 0 : table.emit(`cell-${name}`, row, column, cell, event);\n      }\n    }\n\n    table == null ? void 0 : table.emit(`row-${name}`, row, column, event);\n  };\n\n  const handleDoubleClick = (event, row) => {\n    handleEvent(event, row, \"dblclick\");\n  };\n\n  const handleClick = (event, row) => {\n    props.store.commit(\"setCurrentRow\", row);\n    handleEvent(event, row, \"click\");\n  };\n\n  const handleContextMenu = (event, row) => {\n    handleEvent(event, row, \"contextmenu\");\n  };\n\n  const handleMouseEnter = debounce(index => {\n    props.store.commit(\"setHoverRow\", index);\n  }, 30);\n  const handleMouseLeave = debounce(() => {\n    props.store.commit(\"setHoverRow\", null);\n  }, 30);\n\n  const handleCellMouseEnter = (event, row) => {\n    var _a;\n\n    const table = parent;\n    const cell = getCell(event);\n    const namespace = (_a = table == null ? void 0 : table.vnode.el) == null ? void 0 : _a.dataset.prefix;\n\n    if (cell) {\n      const column = getColumnByCell({\n        columns: props.store.states.columns.value\n      }, cell, namespace);\n      const hoverState = table.hoverState = {\n        cell,\n        column,\n        row\n      };\n      table == null ? void 0 : table.emit(\"cell-mouse-enter\", hoverState.row, hoverState.column, hoverState.cell, event);\n    }\n\n    const cellChild = event.target.querySelector(\".cell\");\n\n    if (!(hasClass(cellChild, `${namespace}-tooltip`) && cellChild.childNodes.length)) {\n      return;\n    }\n\n    const range = document.createRange();\n    range.setStart(cellChild, 0);\n    range.setEnd(cellChild, cellChild.childNodes.length);\n    const rangeWidth = range.getBoundingClientRect().width;\n    const padding = (Number.parseInt(getStyle(cellChild, \"paddingLeft\"), 10) || 0) + (Number.parseInt(getStyle(cellChild, \"paddingRight\"), 10) || 0);\n\n    if (rangeWidth + padding > cellChild.offsetWidth || cellChild.scrollWidth > cellChild.offsetWidth) {\n      createTablePopper(cell, cell.innerText || cell.textContent, {\n        placement: \"top\",\n        strategy: \"fixed\"\n      }, row.tooltipEffect);\n    }\n  };\n\n  const handleCellMouseLeave = event => {\n    const cell = getCell(event);\n    if (!cell) return;\n    const oldHoverState = parent == null ? void 0 : parent.hoverState;\n    parent == null ? void 0 : parent.emit(\"cell-mouse-leave\", oldHoverState == null ? void 0 : oldHoverState.row, oldHoverState == null ? void 0 : oldHoverState.column, oldHoverState == null ? void 0 : oldHoverState.cell, event);\n  };\n\n  return {\n    handleDoubleClick,\n    handleClick,\n    handleContextMenu,\n    handleMouseEnter,\n    handleMouseLeave,\n    handleCellMouseEnter,\n    handleCellMouseLeave,\n    tooltipContent,\n    tooltipTrigger\n  };\n}\n\nexport { useEvents as default };","map":{"version":3,"mappings":"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","names":["useEvents","props","parent","inject","TABLE_INJECTION_KEY","tooltipContent","ref","tooltipTrigger","h","handleEvent","event","row","name","_a","table","cell","getCell","column","namespace","vnode","el","dataset","prefix","getColumnByCell","columns","store","states","value","emit","handleDoubleClick","handleClick","commit","handleContextMenu","handleMouseEnter","debounce","index","handleMouseLeave","handleCellMouseEnter","hoverState","cellChild","target","querySelector","hasClass","childNodes","length","range","document","createRange","setStart","setEnd","rangeWidth","getBoundingClientRect","width","padding","Number","parseInt","getStyle","offsetWidth","scrollWidth","createTablePopper","innerText","textContent","placement","strategy","tooltipEffect","handleCellMouseLeave","oldHoverState"],"sources":["../../../../../../../packages/components/table/src/table-body/events-helper.ts"],"sourcesContent":["import { h, inject, ref } from 'vue'\nimport { debounce } from 'lodash-unified'\nimport { getStyle, hasClass } from '@element-plus/utils'\nimport { createTablePopper, getCell, getColumnByCell } from '../util'\nimport { TABLE_INJECTION_KEY } from '../tokens'\nimport type { TableColumnCtx } from '../table-column/defaults'\nimport type { TableBodyProps } from './defaults'\n\nfunction useEvents<T>(props: Partial<TableBodyProps<T>>) {\n  const parent = inject(TABLE_INJECTION_KEY)\n  const tooltipContent = ref('')\n  const tooltipTrigger = ref(h('div'))\n  const handleEvent = (event: Event, row: T, name: string) => {\n    const table = parent\n    const cell = getCell(event)\n    let column: TableColumnCtx<T>\n    const namespace = table?.vnode.el?.dataset.prefix\n    if (cell) {\n      column = getColumnByCell(\n        {\n          columns: props.store.states.columns.value,\n        },\n        cell,\n        namespace\n      )\n      if (column) {\n        table?.emit(`cell-${name}`, row, column, cell, event)\n      }\n    }\n    table?.emit(`row-${name}`, row, column, event)\n  }\n  const handleDoubleClick = (event: Event, row: T) => {\n    handleEvent(event, row, 'dblclick')\n  }\n  const handleClick = (event: Event, row: T) => {\n    props.store.commit('setCurrentRow', row)\n    handleEvent(event, row, 'click')\n  }\n  const handleContextMenu = (event: Event, row: T) => {\n    handleEvent(event, row, 'contextmenu')\n  }\n  const handleMouseEnter = debounce((index: number) => {\n    props.store.commit('setHoverRow', index)\n  }, 30)\n  const handleMouseLeave = debounce(() => {\n    props.store.commit('setHoverRow', null)\n  }, 30)\n  const handleCellMouseEnter = (\n    event: MouseEvent,\n    row: T & { tooltipEffect: string }\n  ) => {\n    const table = parent\n    const cell = getCell(event)\n    const namespace = table?.vnode.el?.dataset.prefix\n    if (cell) {\n      const column = getColumnByCell(\n        {\n          columns: props.store.states.columns.value,\n        },\n        cell,\n        namespace\n      )\n      const hoverState = (table.hoverState = { cell, column, row })\n      table?.emit(\n        'cell-mouse-enter',\n        hoverState.row,\n        hoverState.column,\n        hoverState.cell,\n        event\n      )\n    }\n\n    // 判断是否text-overflow, 如果是就显示tooltip\n    const cellChild = (event.target as HTMLElement).querySelector(\n      '.cell'\n    ) as HTMLElement\n    if (\n      !(\n        hasClass(cellChild, `${namespace}-tooltip`) &&\n        cellChild.childNodes.length\n      )\n    ) {\n      return\n    }\n    // use range width instead of scrollWidth to determine whether the text is overflowing\n    // to address a potential FireFox bug: https://bugzilla.mozilla.org/show_bug.cgi?id=1074543#c3\n    const range = document.createRange()\n    range.setStart(cellChild, 0)\n    range.setEnd(cellChild, cellChild.childNodes.length)\n    const rangeWidth = range.getBoundingClientRect().width\n    const padding =\n      (Number.parseInt(getStyle(cellChild, 'paddingLeft'), 10) || 0) +\n      (Number.parseInt(getStyle(cellChild, 'paddingRight'), 10) || 0)\n    if (\n      rangeWidth + padding > cellChild.offsetWidth ||\n      cellChild.scrollWidth > cellChild.offsetWidth\n    ) {\n      createTablePopper(\n        cell,\n        cell.innerText || cell.textContent,\n        {\n          placement: 'top',\n          strategy: 'fixed',\n        },\n        row.tooltipEffect\n      )\n    }\n  }\n  const handleCellMouseLeave = (event) => {\n    const cell = getCell(event)\n    if (!cell) return\n\n    const oldHoverState = parent?.hoverState\n    parent?.emit(\n      'cell-mouse-leave',\n      oldHoverState?.row,\n      oldHoverState?.column,\n      oldHoverState?.cell,\n      event\n    )\n  }\n\n  return {\n    handleDoubleClick,\n    handleClick,\n    handleContextMenu,\n    handleMouseEnter,\n    handleMouseLeave,\n    handleCellMouseEnter,\n    handleCellMouseLeave,\n    tooltipContent,\n    tooltipTrigger,\n  }\n}\n\nexport default useEvents\n"]},"metadata":{},"sourceType":"module"}