{"ast":null,"code":"import { ref, computed } from 'vue';\n\nfunction useAllowCreate(props, states) {\n  const createOptionCount = ref(0);\n  const cachedSelectedOption = ref(null);\n  const enableAllowCreateMode = computed(() => {\n    return props.allowCreate && props.filterable;\n  });\n\n  function hasExistingOption(query) {\n    const hasValue = option => option.value === query;\n\n    return props.options && props.options.some(hasValue) || states.createdOptions.some(hasValue);\n  }\n\n  function selectNewOption(option) {\n    if (!enableAllowCreateMode.value) {\n      return;\n    }\n\n    if (props.multiple && option.created) {\n      createOptionCount.value++;\n    } else {\n      cachedSelectedOption.value = option;\n    }\n  }\n\n  function createNewOption(query) {\n    if (enableAllowCreateMode.value) {\n      if (query && query.length > 0 && !hasExistingOption(query)) {\n        const newOption = {\n          value: query,\n          label: query,\n          created: true,\n          disabled: false\n        };\n\n        if (states.createdOptions.length >= createOptionCount.value) {\n          states.createdOptions[createOptionCount.value] = newOption;\n        } else {\n          states.createdOptions.push(newOption);\n        }\n      } else {\n        if (props.multiple) {\n          states.createdOptions.length = createOptionCount.value;\n        } else {\n          const selectedOption = cachedSelectedOption.value;\n          states.createdOptions.length = 0;\n\n          if (selectedOption && selectedOption.created) {\n            states.createdOptions.push(selectedOption);\n          }\n        }\n      }\n    }\n  }\n\n  function removeNewOption(option) {\n    if (!enableAllowCreateMode.value || !option || !option.created || option.created && props.reserveKeyword && states.inputValue === option.label) {\n      return;\n    }\n\n    const idx = states.createdOptions.findIndex(it => it.value === option.value);\n\n    if (~idx) {\n      states.createdOptions.splice(idx, 1);\n      createOptionCount.value--;\n    }\n  }\n\n  function clearAllNewOption() {\n    if (enableAllowCreateMode.value) {\n      states.createdOptions.length = 0;\n      createOptionCount.value = 0;\n    }\n  }\n\n  return {\n    createNewOption,\n    removeNewOption,\n    selectNewOption,\n    clearAllNewOption\n  };\n}\n\nexport { useAllowCreate };","map":{"version":3,"mappings":"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","names":["useAllowCreate","props","states","createOptionCount","ref","cachedSelectedOption","enableAllowCreateMode","computed","allowCreate","filterable","hasExistingOption","query","hasValue","option","value","options","some","createdOptions","selectNewOption","multiple","created","createNewOption","length","newOption","label","disabled","push","selectedOption","removeNewOption","reserveKeyword","inputValue","idx","findIndex","it","splice","clearAllNewOption"],"sources":["../../../../../../packages/components/select-v2/src/useAllowCreate.ts"],"sourcesContent":["import { computed, ref } from 'vue'\nimport type { ISelectProps } from './token'\nimport type { Option } from './select.types'\n\nexport function useAllowCreate(props: ISelectProps, states) {\n  const createOptionCount = ref(0)\n  const cachedSelectedOption = ref<Option>(null)\n\n  const enableAllowCreateMode = computed(() => {\n    return props.allowCreate && props.filterable\n  })\n\n  function hasExistingOption(query: string) {\n    const hasValue = (option) => option.value === query\n    return (\n      (props.options && props.options.some(hasValue)) ||\n      states.createdOptions.some(hasValue)\n    )\n  }\n\n  function selectNewOption(option: Option) {\n    if (!enableAllowCreateMode.value) {\n      return\n    }\n    if (props.multiple && option.created) {\n      createOptionCount.value++\n    } else {\n      cachedSelectedOption.value = option\n    }\n  }\n\n  function createNewOption(query: string) {\n    if (enableAllowCreateMode.value) {\n      if (query && query.length > 0 && !hasExistingOption(query)) {\n        const newOption = {\n          value: query,\n          label: query,\n          created: true,\n          disabled: false,\n        }\n        if (states.createdOptions.length >= createOptionCount.value) {\n          states.createdOptions[createOptionCount.value] = newOption\n        } else {\n          states.createdOptions.push(newOption)\n        }\n      } else {\n        if (props.multiple) {\n          states.createdOptions.length = createOptionCount.value\n        } else {\n          const selectedOption = cachedSelectedOption.value\n          states.createdOptions.length = 0\n          if (selectedOption && selectedOption.created) {\n            states.createdOptions.push(selectedOption)\n          }\n        }\n      }\n    }\n  }\n\n  function removeNewOption(option: Option) {\n    if (\n      !enableAllowCreateMode.value ||\n      !option ||\n      !option.created ||\n      (option.created &&\n        props.reserveKeyword &&\n        states.inputValue === option.label)\n    ) {\n      return\n    }\n    const idx = states.createdOptions.findIndex(\n      (it) => it.value === option.value\n    )\n    if (~idx) {\n      states.createdOptions.splice(idx, 1)\n      createOptionCount.value--\n    }\n  }\n\n  function clearAllNewOption() {\n    if (enableAllowCreateMode.value) {\n      states.createdOptions.length = 0\n      createOptionCount.value = 0\n    }\n  }\n\n  return {\n    createNewOption,\n    removeNewOption,\n    selectNewOption,\n    clearAllNewOption,\n  }\n}\n"]},"metadata":{},"sourceType":"module"}